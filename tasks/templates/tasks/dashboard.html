{% extends "tasks/base.html" %}

{% block content %}
<div class = "layout">
    <div class = "nav">
        {% if request.user.is_authenticated %}
        <h1>Welcome {{ request.user.username }} to the To-Do App</h1>
        {% endif %}
    </div>
    <aside class = "left">
        <h2>Create a New Task</h2>
        <label for="task_type">
            Task Type:
            <select id="task_type" name="task_type">
                <option value="normal">Normal Task</option>
                <option value="continuous">Continuous Task</option>
            </select>
        </label>

        <!-- Normal task form -->
        <form id="normal_form" method="post" action="{% url 'create_task' %}">
            {% csrf_token %}
            <input type="hidden" name="task_type" value="normal">
            {{ normal_task_form.as_p }}
            <button type="submit">Create Task</button>
        </form>

        <!-- Continuous task form, hidden by default -->
        <form id="continuous_form" method="post" action="{% url 'create_task' %}" style="display:none;">
            {% csrf_token %}
            <input type="hidden" name="task_type" value="continuous">
            {{ continuous_task_form.as_p }}
            <button type="submit">Create Task</button>
        </form>



        <h3>Normal Tasks:</h3>
        <ul>
            {% for task in normal_tasks %}
                <li>{{ task.title }} | <a href="{% url 'edit_task' task.id 'normal' %}">Edit</a></li>
            {% empty %}
                <li>No normal tasks available.</li>
            {% endfor %}

        </ul>

        <h3>Continuous Tasks:</h3>
        <ul>
            {% for task in continuous_tasks %}
                <li>{{ task.title }} | <a href="{% url 'edit_task' task.id 'continuous' %}">Edit</a></li>
            {% empty %}
                <li>No continuous tasks available.</li>
            {% endfor %}
        </ul>
    </aside>


    <main class = "center">
        <h2>Dice Roll Game</h2>
        {% if not request.session.result %}
        <form method="post" action="{% url 'dice_roll' %}">
            {% csrf_token %}
            <h2><button type="submit">Roll the Dice!!!</button></h2>
        </form>
        {% endif %}

        {% if request.session.result.type == 'break' %}
        <h2>Dice Roll Result: Take a break!</h2>
        <form method="post" action="{% url 'dice_roll' %}">
            {% csrf_token %}
            <h2><button type="submit">Roll again</button></h2>
        </form>
        {% elif request.session.result.type == 'task' %}
        <h2>Dice Roll Result: {{ request.session.result.task_title }}</h2>
        <form method="post" action="{% url 'complete_task' request.session.result.task_id request.session.result.task_type %}">
            {% csrf_token %}
            <button type="submit">Complete Task</button>
        </form>
        {% if request.session.result.task_type == 'continuous' %}
        <form method="post" action="{% url 'increment_work_time' request.session.result.task_id %}">
            {% csrf_token %}
            <button type="submit">+1 hour!</button>
        </form>
        {% endif %}
        <form method="post" action="{% url 'dice_roll' %}">
            {% csrf_token %}
            <h2><button type="submit">Roll again!</button></h2>
        </form>
        {% endif %}
    </main>



    <aside class = "right">
        <h2>Task Status</h2>
        <h3>Not Started Tasks:</h3>
        <ul>
            {% for task in not_started %}
                <li>{{ task.title }}</li>
            {% empty %}
                <li>You started all tasks!!!</li>
            {% endfor %}
        </ul>

        <h3>On Going Tasks:</h3>
        <ul>
            {% for task in on_going %}
                <li>{{ task.title }} - {{ task.work_time }} hours</li>
            {% empty %}
                <li>No on going tasks.</li>
            {% endfor %}
        </ul>

        <h3>Completed Tasks:</h3>
        <ul>
            {% for task in completed %}
                <li>{{ task.title }}</li>
            {% empty %}
                <li>No completed tasks.</li>
            {% endfor %}
        </ul>
    </aside>

</div>

<script>
  // Get references to the dropdown and forms
  const selector = document.getElementById('task_type');
  const normalForm = document.getElementById('normal_form');
  const continuousForm = document.getElementById('continuous_form');

  // Function to show/hide forms based on selection
  function updateFormState() {
    if (selector.value === 'normal') {
      normalForm.style.display = 'block';
      continuousForm.style.display = 'none';
    } else {
      normalForm.style.display = 'none';
      continuousForm.style.display = 'block';
    }
  }

  // Listen for changes in the dropdown
  selector.addEventListener('change', updateFormState);
  
  // Set initial state
  updateFormState();
</script>

{% endblock %}