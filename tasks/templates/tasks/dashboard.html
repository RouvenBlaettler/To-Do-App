{% extends "tasks/base.html" %}

{% block content %}
{% if request.user.is_authenticated %}
<h1>Welcome {{ request.user.username }} to the To-Do App</h1>
{% endif %}
<h2>Create a New Task</h2>
<form method="post">
    {% csrf_token %}
    <label for="task_type">
        Task Type:
        <select id="task_type" name="task_type">
            <option value="normal">Normal Task</option>
            <option value="continuous">Continuous Task</option>
        </select>
    </label>
    <!-- Normal task form -->
    <div id="normal_form_div">
        {{ normal_task_form.as_p }}
    </div>

    <!-- Continuous task form, hidden by default -->
    <div id="continuous_form_div" style="display:none;">
        {{ continuous_task_form.as_p }}
    </div>
    <button type="submit">Create Task</button>
</form>

<hr>


<h3>Normal Tasks:</h3>
<ul>
    {% for task in normal_tasks %}
        <li>{{ task.title }} | <a href="{% url 'edit_task' task.id 'normal' %}">Edit</a></li>
    {% empty %}
        <li>No normal tasks available.</li>
    {% endfor %}

</ul>

<h3>Continuous Tasks:</h3>
<ul>
    {% for task in continuous_tasks %}
        <li>{{ task.title }} | <a href="{% url 'edit_task' task.id 'continuous' %}">Edit</a></li>
    {% empty %}
        <li>No continuous tasks available.</li>
    {% endfor %}
</ul>

{% if not request.session.result %}
<form method="post" action="{% url 'dice_roll' %}">
    {% csrf_token %}
    <h2><button type="submit">Roll the Dice!!!</button></h2>
</form>
{% endif %}

{% if request.session.result.type == 'break' %}
<h2>Dice Roll Result: Take a break!</h2>
<form method="post" action="{% url 'dice_roll' %}">
    {% csrf_token %}
    <h2><button type="submit">Roll again</button></h2>
</form>
{% elif request.session.result.type == 'task' %}
<h2>Dice Roll Result: {{ request.session.result.task_title }}</h2>
<form method="post" action="{% url 'complete_task' request.session.result.task_id request.session.result.task_type %}">
    {% csrf_token %}
    <button type="submit">Complete Task</button>
</form>
{% if request.session.result.task_type == 'continuous' %}
<form method="post" action="{% url 'increment_work_time' request.session.result.task_id %}">
    {% csrf_token %}
    <button type="submit">+1 hour!</button>
</form>
{% endif %}
<form method="post" action="{% url 'dice_roll' %}">
    {% csrf_token %}
    <h2><button type="submit">Roll again!</button></h2>
</form>
{% endif %}




<h2>Task Status</h2>
<h3>Not Started Tasks:</h3>
<ul>
    {% for task in not_started %}
        <li>{{ task.title }}</li>
    {% empty %}
        <li>You started all tasks!!!</li>
    {% endfor %}
</ul>

<h3>On Going Tasks:</h3>
<ul>
    {% for task in on_going %}
        <li>{{ task.title }} - {{ task.work_time }} hours</li>
    {% empty %}
        <li>No on going tasks.</li>
    {% endfor %}
</ul>

<h3>Completed Tasks:</h3>
<ul>
    {% for task in completed %}
        <li>{{ task.title }}</li>
    {% empty %}
        <li>No completed tasks.</li>
    {% endfor %}
</ul>

<script>
  // Get references to the dropdown and form divs
  const selector = document.getElementById('task_type');
  const normalDiv = document.getElementById('normal_form_div');
  const continuousDiv = document.getElementById('continuous_form_div');

  // Function to enable/disable form fields
  function updateFormState() {
    const normalInputs = normalDiv.querySelectorAll('input, select, textarea');
    const continuousInputs = continuousDiv.querySelectorAll('input, select, textarea');
    
    if (selector.value === 'normal') {
      normalDiv.style.display = 'block';
      continuousDiv.style.display = 'none';
      
      // Enable normal form fields
      normalInputs.forEach(input => input.disabled = false);
      // Disable continuous form fields
      continuousInputs.forEach(input => input.disabled = true);
    } else {
      normalDiv.style.display = 'none';
      continuousDiv.style.display = 'block';
      
      // Disable normal form fields
      normalInputs.forEach(input => input.disabled = true);
      // Enable continuous form fields
      continuousInputs.forEach(input => input.disabled = false);
    }
  }

  // Listen for changes in the dropdown
  selector.addEventListener('change', updateFormState);
  
  // Set initial state
  updateFormState();
</script>

{% endblock %}